!function(e,t,a){"use strict";var i=function(t,a){this.index=i.indexs.push(this),this.options=a,this.$element=t,this.url=a.url,this.call=a.call,this.offset=a.offset,this.headBreakPage=a.headBreakPage,this.renderView=a.renderView,this.viewContainer=this.initDataView(a.viewContainer),this._reservePageSize=2,this._footBreakPage=0,this._reqParams=e.extend({},a.param,this.parseHash()),this.load(this._reqParams),this.attachScrollable(),this.intervalReload(),this.isEnd=!1};i.indexs=[],i.DEFAULT={call:"get",interval:!1,show:!0,scrollable:!1,viewHeight:!1,viewWidth:!1,hashable:!0,param:{limit:10,page:1},offset:3,headBreakPage:7,onBeforeLoad:e.noop,onComplete:e.noop,onAfterRender:e.noop},i.FIRST_LOAD=!0,i.NOT_FIRST_LOAD=!1,i.prototype.getCurrentPage=function(){return this._reqParams.page?parseInt(this._reqParams.page):1},i.prototype.intervalReload=function(){var e=this;e.options.interval&&parseInt(e.options.interval)>0&&a.setInterval(function(){e.reload()},e.options.interval)},i.prototype.initDataView=function(t){this.viewContainer=e(t);var a={};return this.options.viewHeight&&(a.height=this.options.viewHeight,a.display="block",a.width="100%"),this.options.viewWidth&&(a.width=this.options.viewWidth),this.viewContainer.css(a),this.viewContainer},i.prototype.hasPrevPage=function(){return this.pageNum>1},i.prototype.createHash=function(e){if(this.options.hashable){var t=[];for(var a in e)t.push(a),t.push(e[a]);return"#pw"+this.index+"~"+t.join("~")}return""},i.prototype.writeHash=function(t){if(this.options.hashable){var a=e.extend({},this._reqParams,{page:t});return this.createHash(a)}return""},i.prototype.parseHash=function(){var e={};if(this.options.hashable&&location.hash){var t=location.hash.split("||");for(var a in t){var i=t[a].split("~");if(i.length>0&&"#pw"+this.index==i[0]){for(var r=1;r<i.length;r+=2)e[i[r]]=i[r+1];break}}}return e},i.prototype.updateHash=function(e){if(this.options.hashable){var t=[];if(location.hash.length>0){t=location.hash.split("||");var a=-1;for(var i in t){var r=t[i].split("~");if(r.length>0&&"#pw"+this.index==r[0]){a=i;break}}a>-1&&t.splice(a,1)}t.push(e),location.hash=t.join("||")}},i.prototype.parseQueryString=function(e){var t={},a=[],i="",r="",s=e.split("&");for(var o in s)i=(a=s[o].split("="))[0],r=a[1],t[i]=r;return t},i.prototype.prevPage=function(){return this.hasPrevPage()?this.pageNum-1:this.pageNum},i.prototype.hasNextPage=function(){return this.pageNum<this.pages},i.prototype.nextPage=function(){return this.hasNextPage()?this.pageNum+1:this.pageNum},i.prototype.renderPager=function(){if(this.options.show){var t=this,a="";a+=this.renderPrev(),a+=this.renderHeadPages(),a+=this.renderBodyPages(),a+=this.renderFootPages(),a+=this.renderNext(),this.$element.html('<ul class="pagination">'+a+"</ul>").off("click.page.wrapper").on("click.page.wrapper","a[data-page]",function(a){a.preventDefault();var i=e.extend({},t._reqParams,e(this).data());t.update(i)})}else this.$element.hide()},i.prototype.getActiveClass=function(e){return e==this.pageNum?'class="active"':""},i.prototype.renderPages=function(e,t){for(var a="",i=e;i<=t;i++)a+="<li "+this.getActiveClass(i)+'><a href="'+this.writeHash(i)+'" data-page="'+i+'">'+i+"</a></li>";return a},i.prototype.renderHeadPages=function(){var e="";if(this.pageNum<=this.headBreakPage){if(this.pages>1&&(e+=this.renderPages(1,t.min(this.headBreakPage,this.pages))),this.pageNum==this.headBreakPage){var a=this.headBreakPage+1;e+='<li><a href="'+this.writeHash(a)+'" data-page="'+a+'">'+a+"</a></li>"}}else e+=this.renderPages(1,2),this.pages>8&&(e+='<li class="disabled"><a href="#">...</a></li>');return e},i.prototype.renderFootPages=function(){var e="";return this.pages>this.headBreakPage&&(this.pages>this._footBreakPage+this._reservePageSize&&(e+='<li class="disabled"><a href="#">...</a></li>'),e+=this.renderPages(this.pages-1,this.pages)),e},i.prototype.renderBodyPages=function(){return this.pageNum>this.headBreakPage&&this.pages>this.headBreakPage+this.offset+1?(this._footBreakPage=t.min(this.pageNum+this.offset,this.pages-this._reservePageSize),this.renderPages(this.pageNum-this.offset,this._footBreakPage)):""},i.prototype.renderPrev=function(){return this.pages>1?this.hasPrevPage()?'<li class="previous"><a href="'+this.writeHash(this.prevPage())+'" data-page="'+this.prevPage()+'">«</a></li>':'<li class="previous disabled"><a href="#">«</a></li>':""},i.prototype.renderNext=function(){return this.pages>1?this.hasNextPage()?'<li class="next"><a href="'+this.writeHash(this.nextPage())+'" data-page="'+this.nextPage()+'">»</a></li>':'<li class="next disabled"><a href="#">»</a></li>':""},i.prototype.renderData=function(e,t,a){if("function"==typeof this.renderView){var i=this.renderView.call(this,e,t,a);i&&(this.options.scrollable?this.viewContainer.append(i):this.viewContainer.html(i),"function"==typeof this.options.onAfterRender&&this.options.onAfterRender(this,t,a))}},i.prototype.attachScrollable=function(){var e=this;e.options.scrollable&&e.viewContainer.off("scroll.page.wapper").on("scroll.page.wrapper",function(){0==e.isEnd&&(t.ceil(e.viewContainer.scrollTop()+e.viewContainer.outerHeight())>=e.viewContainer[0].scrollHeight&&e.update({page:e.getCurrentPage()+1}))}).css({overflowY:"scroll"})},i.prototype.loadData=function(a,i){"string"==typeof a&&(a=this.parseQueryString(a));var r=this;r.call&&r.url&&(r.url=r.url.replace(/page=\d*&*/i,""),a=e.extend(r._reqParams,a),r.updateHash(this.createHash(a)),"function"==typeof r.options.onBeforeLoad&&r.options.onBeforeLoad.call(r),e[r.call](r.url,a,function(e){"0"==e.code&&(r.isEnd=null!=e.data&&e.data.constructor==Array.prototype.constructor&&e.data.length>0||null==e.data||void 0===e.data,r.pageNum=a.page||1,r.pages=t.ceil(e.count/a.limit),r.renderPager(),r.renderData(e.data,i,e))}).complete(function(){"function"==typeof r.options.onComplete&&r.options.onComplete.call(r)}))},i.prototype.load=function(e){this.loadData(e,i.FIRST_LOAD)},i.prototype.update=function(e){this.loadData(e,i.NOT_FIRST_LOAD)},i.prototype.reload=function(t){"string"==typeof t&&(t=this.parseQueryString(t)),t=e.extend({},t,{page:1}),this.loadData(t,i.FIRST_LOAD)},i.prototype.refresh=function(){this.loadData(this._reqParams,i.NOT_FIRST_LOAD)},i.prototype.upateUrl=function(e){this.url=e},i.prototype.setOptions=function(t){e.extend(this,t)};var r=e.fn.pageWrapper;e.fn.pageWrapper=function(t){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var r=e(this),s=r.data("page.wrapper"),o=e.extend(!0,{},i.DEFAULT,r.data(),"object"==typeof t&&t);s||r.data("page.wrapper",s=new i(r,o)),s&&"string"==typeof t&&s[t].apply(s,a)})},e.fn.pageWrapper.Constructor=i,e.fn.pageWrapper.noConflict=function(){return e.fn.pageWrapper=r,this}}(jQuery,Math,window);